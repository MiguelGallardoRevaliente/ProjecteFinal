<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Battle - Chamous</title>
    <link rel="stylesheet" href="css/combat.css">
    <script type="module">
        import { io } from 'https://cdn.socket.io/4.3.2/socket.io.esm.min.js'

        const username = localStorage.getItem('username')

        if (!username && !localStorage.getItem('password')) {
            window.location.href = '/login'
        } else if (username && localStorage.getItem('password')) {
            fetch(`/checkUser?username=${username}&password=${localStorage.getItem('password')}`)
                .then(response => response.json())
                .then(data => {
                    if (data.message !== 'userExists') {
                        localStorage.removeItem('username')
                        localStorage.removeItem('password')
                        localStorage.removeItem('id')
                        window.location.href = '/login'
                    }
                })
        }

        window.onload = () => {
            fetch(`getCardsBattle?id=${localStorage.getItem('id')}`)
                .then(response => response.json())
                .then(data => {
                    console.log(data)
                    data.forEach(card => {
                        const user = document.getElementsByClassName('user')[0]
                        const profilePicture = document.createElement('img')
                        profilePicture.src = card.user.foto_perfil
                        profilePicture.alt = 'Profile Picture', card.user.user
                        profilePicture.classList.add('profilePicture')

                        const username = document.createElement('p')
                        username.textContent = card.user.user
                        username.classList.add('username')

                        user.appendChild(profilePicture)
                        user.appendChild(username)

                        const yourCards = document.getElementsByClassName('yourCards')[0]
                        const cardDiv = document.createElement('div')
                        cardDiv.classList.add('card')
                        cardDiv.style.backgroundImage = `url(${card.carta.foto})`
                        cardDiv.style.backgroundSize = 'contain'
                        cardDiv.style.backgroundRepeat = 'no-repeat'
                        cardDiv.style.backgroundPosition = 'center'

                        const cardName = document.createElement('p')
                        cardName.textContent = card.carta.nombre
                        cardName.classList.add('cardName')

                        const ataqueVida = document.createElement('p')
                        ataqueVida.textContent = card.carta.ataque + '/' + card.carta.vida

                        if (card.ataque) {
                            const ataqueEspecial = document.createElement('p')
                            ataqueEspecial.textContent = card.ataque.nombre + ' - ' + card.ataque.descripcion
                            ataqueEspecial.classList.add('ataque-especial')

                            cardDiv.appendChild(ataqueEspecial)
                        }

                        cardDiv.appendChild(cardName)
                        cardDiv.appendChild(ataqueVida)
                        yourCards.appendChild(cardDiv)
                    })
                })
        }
    </script>
</head>
<body>
    <div class="board">

    </div>

    <div class="cards">
        <div class="user"></div>
        
        <div class="yourCards"></div>

    </div>
</body>
</html>